<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="Preslav Rachev">
<meta name="description" content="Dependency Injection (DI) in Python? Seriously? ü§î
At this point, I am expecting people to yell at me for thinking like a Java guy, but just bear with me for a moment, will you? Spoiler: I am going to mention Spring only once in this post, I promise.
NOTE: If you are already familiar with Dependency Injection and want to see it in action, you might want to jump right to the example at the end." />
<meta name="keywords" content="programming, golang, python, Programming, Python" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="#252627" />
<link rel="canonical" href="https://example.com/2018/12/20/dependency-injection-in-python/" />


    <title>
        
            Dependency Injection in Python: The Java Guy&#39;s Perspective :: Random Bits of Wisdom  ‚Äî Hello Friend NG Theme
        
    </title>



<link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.2.1/css/flag-icon.min.css" rel="stylesheet"
    type="text/css">



<link rel="stylesheet" href="https://example.com/main.min.2f0d18b84270567c723bff340b09ab08db3a7634237cd9667d052eb6b14669b8.css">




    <link rel="apple-touch-icon" sizes="180x180" href="https://example.com/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://example.com/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://example.com/favicon-16x16.png">
    <link rel="manifest" href="https://example.com/site.webmanifest">
    <link rel="mask-icon" href="https://example.com/safari-pinned-tab.svg" color="#252627">
    <link rel="shortcut icon" href="https://example.com/favicon.ico">
    <meta name="msapplication-TileColor" content="#252627">
    <meta name="theme-color" content="#252627">


<meta itemprop="name" content="Dependency Injection in Python: The Java Guy&#39;s Perspective">
<meta itemprop="description" content="In this post, I will lay out my arguments why you might want to think about dependency injection for your next Python project. I am not trying to preach a certain style of &#34;best-practice&#34; programming, but simply, to share my perspective from the eyes of a seasoned Java developer.">


<meta itemprop="datePublished" content="2018-12-20T13:34:36&#43;00:00" />
<meta itemprop="dateModified" content="2018-12-20T13:34:36&#43;00:00" />
<meta itemprop="wordCount" content="1546">



<meta itemprop="keywords" content="Programming,Python," />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://example.com"/>

<meta name="twitter:title" content="Dependency Injection in Python: The Java Guy&#39;s Perspective"/>
<meta name="twitter:description" content="In this post, I will lay out my arguments why you might want to think about dependency injection for your next Python project. I am not trying to preach a certain style of &#34;best-practice&#34; programming, but simply, to share my perspective from the eyes of a seasoned Java developer."/>



    <meta property="article:section" content="Programming" />

    <meta property="article:section" content="Python" />



    <meta property="article:published_time" content="2018-12-20 13:34:36 &#43;0000 UTC" />








    </head>

    <body class="dark-theme">
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="https://example.com/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">></span>
            <span class="logo__text">$ cd /home/preslav.me</span>
            <span class="logo__cursor" style=""></span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="https://example.com/about/">About</a></li><li><a href="https://example.com/post/">Blog</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            

            <span class="theme-toggle unselectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>
</span>
        </span>
    </span>
</header>


            <div class="content">
                
    <main class="post">

        <div class="post-info">
            
            </p>
        </div>

        <article>
            <h2 class="post-title"><a href="https://example.com/2018/12/20/dependency-injection-in-python/">Dependency Injection in Python: The Java Guy&rsquo;s Perspective</a></h2>

            

            <div class="post-content">
                

<p>Dependency Injection (DI) in Python? Seriously? ü§î</p>

<p>At this point, I am expecting people to yell at me for thinking like a Java guy, but just bear with me for a moment, will you? <em>Spoiler:</em> I am going to mention Spring only once in this post, I promise.</p>

<p><strong><em>NOTE:</em></strong> If you are already familiar with Dependency Injection and want to see it in action, you might want to jump right to <a href="#a-more-complex-example">the example</a> at the end. Otherwise, keep reading. As always, feel free to send me a <a href="https://twitter.com/intent/tweet?text=%40preslavrachev%20%5BADD%20YOUR%20COMMENT%20HERE%5D&amp;url=https://preslav.me/p/3c4daf3d-607c-49e4-8aa9-c87a61be1697/&amp;related=preslavrachev" target="_blank">‚úèÔ∏ècomment on Twitter</a>. Your feedback is more than appreciated.</p>

<p>&hellip;</p>

<h1 id="let-s-get-things-straight">Let&rsquo;s Get Things Straight</h1>

<p>While I am definitely approaching Python software development from my close-to-a-decade  experience building Java software, I am not trying to preach to you a certain style of programming. Take this simply as a different perspective on things. The Python Universe is so immense that it will be a crime to pretend that DI is necessary for every Python project. While certain types of Python projects will definitely benefit from a bit more structure, for many others, DI might become the worst nightmare. I will try to write down my reasons, and leave the final decision to the reader.</p>

<h1 id="a-quick-detour-on-dependency-injection">A Quick Detour on Dependency Injection</h1>

<p>I will save you the lecture here. I am sure that many of you already know what DI is all about. Perhaps, some of you have already looked at, if not even read Martin Fowler&rsquo;s <a href="https://martinfowler.com/articles/injection.html" target="_blank">Dependency Injection essay</a>. Even if you haven&rsquo;t, don&rsquo;t panic. I will share you a secret, and that is, <strong>you already know DI, and have used it many times,</strong> even if you haven&rsquo;t used a particular name for it.</p>

<p>There is one golden prerequisite for Dependency Injection and that is, Separation of Concerns. Put simply, group logic in separable units, and let these units work together, without any of them knowing much about the implementation details of the other. OOP calls such units <em>classes</em>, and FP, <em>functions</em>. The point is, <em>units isolate common logic</em>. Let&rsquo;s add to this the requirement that no unit explicitly instantiates the units it works with (dependencies). Instead, dependencies are passed upon the unit (injected), usually, during its instantiation.</p>

<p>So, DI is a fancy term for instantiating classes in a top-level module, and passing them as initializer arguments to one another:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Api</span>:
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">fetch_remote_data</span>(self):
        <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;Api called&#39;</span>)
        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">42</span>


<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">BusinessLogic</span>:
    <span style="color:#66d9ef">def</span> __init__(self, api: Api):
        self<span style="color:#f92672">.</span>api <span style="color:#f92672">=</span> api

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">do_stuff</span>(self):
        api_result <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>api<span style="color:#f92672">.</span>fetch_remote_data()
        <span style="color:#66d9ef">print</span>(f<span style="color:#e6db74">&#39;the api returned a result: {api_result}&#39;</span>)
        <span style="color:#75715e"># do something with the data and return a result</span>

<span style="color:#75715e"># ---</span>

<span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;__main__&#39;</span>:
    api <span style="color:#f92672">=</span> Api()
    logic <span style="color:#f92672">=</span> BusinessLogic(api<span style="color:#f92672">=</span>api)

    <span style="color:#75715e"># ...</span>
    <span style="color:#66d9ef">print</span>(logic<span style="color:#f92672">.</span>do_stuff())</code></pre></div>
<p>There are of course, more Pythonic ways of implementing Dependency Injection. I realize that the one I provided above is very Java-like. I have tried to collect a list of Python-related resources you might want to consult. You will find it at the end of this post.</p>

<h1 id="where-explicit-dependency-injection-might-help">Where Explicit Dependency Injection Might Help</h1>

<p>I already tried to make it clear that DI is not a silver bullet, and due to Python&rsquo;s versatility of use, it might not fit to every project. In some, it might even hamper the development of the project.</p>

<p>Python was created to give its developers the freedom to just do things, without sweating much about structure or ceremony, when those are not needed. This is why the Python ecosystem is perfect for scratching out ideas and prototyping, single-purpose CLI tools, or scripts with limited scope and lifetime.</p>

<p>Yet, for many of these projects, there comes a time, when they grow, or are bound to grow from the onset, and with this growth comes a different set of challenges. Where I see DI fit best, are projects with established requirements, serving a large number of stakeholders. The challenge here is to scale and constantly improve the system, without compromising its stability.</p>

<p><strong>Advantages</strong></p>

<p>Adding DI to your project will potentially</p>

<ul>
<li>increase its testability and reusability, because by design, it allows for easily replacing one component with another (great for mocking, or replacing one concrete implementation with another)</li>
<li>increase the readability. When applying DI your top-level model becomes sort of an orchestrator, instantiating your units and passing dependencies to them. Although this might add a bit of boilerplate, it helps ensure that all the LEGO-block wiring-up happens in one place, and this place will always be the starting point of your later investigations.</li>
<li>adds a certain level of common understanding between programmers of different backgrounds. While I am sure that many of you would come up with some more elegant and more Pythonic ways for solving the dependency issue, some of them might be too obscure for non-Python gurus (hi there üëãüèº) and lead to misunderstanding, lost communication, and potentially, compromising the resilience of the end product.</li>
</ul>

<p><strong>Disadvantages</strong></p>

<p>Well, the boilerplate and ceremony might be quite of an issue for some Python purists.</p>

<h1 id="a-more-complex-example">A More Complex Example</h1>

<p>I have already mentioned it a few times that doing all the instantiation and passing dependencies around by hand can be a bit tedious. It can also be complicated, because of the order of instantiation. The core dependencies must be instantiated first, the units that depend on them afterwards, and so on, until the top-level units, whose role is usually to coordinate the flow of data among their dependencies.</p>

<p>There are many Python libraries, which already facilitate this process. Among those, I looked at <a href="https://github.com/ets-labs/python-dependency-injector" target="_blank">python-dependency-injector</a>, <a href="https://github.com/suned/serum" target="_blank">serum</a>, and <a href="https://github.com/alecthomas/injector" target="_blank">injector</a>. I found <a href="https://github.com/alecthomas/injector" target="_blank">injector</a> to be closest to what I have come to know and use on Java - <a href="https://spring.io/" target="_blank">Spring</a> and <a href="https://github.com/google/guice" target="_blank">Guice</a>. It is not the least verbose, but it gets the job done. Let&rsquo;s see how it works:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">pip install injector</code></pre></div>
<p>Let&rsquo;s take the two classes, I have created above:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Api</span>:
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">fetch_remote_data</span>(self):
        <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;Api called&#39;</span>)
        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">42</span>


<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">BusinessLogic</span>:
    <span style="color:#66d9ef">def</span> __init__(self, api: Api):
        self<span style="color:#f92672">.</span>api <span style="color:#f92672">=</span> api

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">do_stuff</span>(self):
        api_result <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>api<span style="color:#f92672">.</span>fetch_remote_data()
        <span style="color:#66d9ef">print</span>(f<span style="color:#e6db74">&#39;the api returned a result: {api_result}&#39;</span>)
        <span style="color:#75715e"># do something with the data and return a result</span></code></pre></div>
<p>The only modification I made, was adding an explicit <a href="https://www.python.org/dev/peps/pep-0484/" target="_blank">type hint</a> to the <code>Api</code> dependency. This will be used by the library to determine the right object to pass at instantiation.</p>

<p>Injector, similar to Guice and Spring, adds the concept of a dependency <code>Module</code>. This is a class that inherits from <code>injector.Module</code> and has a bunch of methods, each corresponding to the initialization of one dependency or the other:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">AppModule</span>(Module):

    <span style="color:#a6e22e">@singleton</span>
    <span style="color:#a6e22e">@provider</span>
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">provide_business_logic</span>(self, api: Api) <span style="color:#f92672">-&gt;</span> BusinessLogic:
        <span style="color:#66d9ef">return</span> BusinessLogic(api<span style="color:#f92672">=</span>api)

    <span style="color:#a6e22e">@singleton</span>
    <span style="color:#a6e22e">@provider</span>
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">provide_api</span>(self) <span style="color:#f92672">-&gt;</span> Api:
        <span style="color:#75715e"># there is no complex logic in our case,</span>
        <span style="color:#75715e"># but you can use this method to hide the complexity of initial </span>
        configuration
        <span style="color:#75715e"># e.g. when instantiating a particular DB connector.</span>
        <span style="color:#66d9ef">return</span> Api()</code></pre></div>
<p>Each of these methods is decorated with <code>@provider</code> (required) and <code>@singleton</code> (optional, only if you want to ensure that the object instance will always remain the same). Pay attention to the use of type hinting here too. One the one hand, it makes the dependency module code more readable, on the other, it is used by the injector library to determine the right objects to return.</p>

<p>Let&rsquo;s see how to use our classes. We need to create an Injector and pass it an instance of our AppModule.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;__main__&#39;</span>:
    injector <span style="color:#f92672">=</span> Injector(AppModule())

    logic <span style="color:#f92672">=</span> injector<span style="color:#f92672">.</span>get(BusinessLogic)
    logic<span style="color:#f92672">.</span>do_stuff()</code></pre></div>
<p>From now on, when you want to obtain an instance which is inside the dependency graph, from outside the graph, you would have to use the injector. Before you start grunting about the rising amount of boilerplate, let me point out that the actual places where you would need to do that, are either your app&rsquo;s main starting points, or API/Web endpoints in the context of a Web application. Actually, if you are building a Flask app, the creator of injector has got you covered. There is an extension for Flask, called <a href="https://github.com/alecthomas/flask_injector" target="_blank">flask-injector,</a> which hides the boilerplate of having to use the injector object directly.</p>

<p>Back to our injector instance. The real benefit of having dependency modules, is when you have several of them, for running your app in different contexts. The simplest example is testing. Let&rsquo;s create a version of our Api class for testing purposes:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TestApi</span>(Api):
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">fetch_remote_data</span>(self):
        <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;Demo Api called&#39;</span>)
        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">24</span></code></pre></div>
<p>Assuming that there might be more classes we&rsquo;d like to mock, we create a separate dependency module for them:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TestAppModule</span>(Module):

    <span style="color:#a6e22e">@singleton</span>
    <span style="color:#a6e22e">@provider</span>
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">provide_api</span>(self) <span style="color:#f92672">-&gt;</span> Api:
        <span style="color:#66d9ef">return</span> TestApi()</code></pre></div>
<p>The real magic happens when creating the injector. You can have as many injectors as you have, and each injector instance can be supplied with as many dependency module configurations as you wish:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;__main__&#39;</span>:
    real_injector <span style="color:#f92672">=</span> Injector(AppModule())
    test_injector <span style="color:#f92672">=</span> Injector([AppModule(), TestAppModule()])

    real_logic <span style="color:#f92672">=</span> real_injector<span style="color:#f92672">.</span>get(BusinessLogic)
    real_logic<span style="color:#f92672">.</span>do_stuff()

    test_logic <span style="color:#f92672">=</span> test_injector<span style="color:#f92672">.</span>get(BusinessLogic)
    test_logic<span style="color:#f92672">.</span>do_stuff()</code></pre></div>
<pre><code>Api called
the api returned a result: 42
Demo Api called
the api returned a result: 24
</code></pre>

<h1 id="the-end">The End</h1>

<p>I will stop here. I hope, if not really having managed to convince you, to have given you a slightly different perspective on things. Until next time!</p>

<hr />

<h1 id="related-resources">Related Resources</h1>

<ul>
<li><a href="https://martinfowler.com/articles/injection.html" target="_blank">Inversion of Control Containers and the Dependency Injection pattern</a></li>
<li><a href="https://medium.com/@suneandreasdybrodebel/pythonic-dependency-injection-a-practical-guide-83a1b1299280" target="_blank">Pythonic Dependency Injection: A Practical Guide - Sune Andreas Dybro Debel - Medium</a></li>
<li><a href="https://python-3-patterns-idioms-test.readthedocs.io/en/latest/index.html" target="_blank">Python 3 Patterns, Recipes and Idioms - Python 3 Patterns, Recipes and Idioms</a></li>
<li><a href="http://python-dependency-injector.ets-labs.org/introduction/di_in_python.html" target="_blank">Dependency injection and inversion of control in Python - Dependency Injector 3.14.2 documentation</a></li>
<li><a href="https://github.com/alecthomas/injector" target="_blank">alecthomas/injector</a></li>
<li><a href="https://github.com/suned/serum" target="_blank">suned/serum</a></li>
<li><a href="https://github.com/ets-labs/python-dependency-injector" target="_blank">ets-labs/python-dependency-injector</a></li>
<li><a href="https://github.com/RobertoPrevato/rodi" target="_blank">RobertoPrevato/rodi</a></li>
</ul>

            </div>
        </article>

        <hr />

        <div class="post-info">
  				<p>
  					<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg><span class="tag"><a href="https://example.com/tags/programming">Programming</a></span><span class="tag"><a href="https://example.com/tags/python">Python</a></span>
  				</p>
  			</div>

        
    </main>

            </div>

            
                <footer class="footer">
    <div class="footer__inner">
        <div class="footer__content">
            <span>&copy; 2020</span>
            
                <span><a href="https://example.com">Preslav Rachev</a></span>
            
            <span><a href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank" rel="noopener">CC BY-NC 4.0</a></span>
            <span> <a href="https://example.com/posts/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></span>
        </div>
    </div>
    <div class="footer__inner">
        <div class="footer__content">
            <span>Powered by <a href="http://gohugo.io">Hugo</a></span>
            <span>Made with &#10084; by <a href="https://github.com/rhazdon">rhazdon</a></span>
        </div>
    </div>
</footer>

            
        </div>

        




<script type="text/javascript" src="https://example.com/bundle.min.8047d1b063234db7e4f910f9d54abd62686428b775f14770e6c6314980002e1d3014e6f9d5df0df37d0a5fd3a15f20b320fb949c4f014e74059de1c57eb0e40a.js" integrity="sha512-gEfRsGMjTbfk&#43;RD51Uq9YmhkKLd18Udw5sYxSYAALh0wFOb51d8N830KX9OhXyCzIPuUnE8BTnQFneHFfrDkCg=="></script>
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-131031623-1', 'auto');
        ga('send', 'pageview');
    </script>



    </body>
</html>
